# CQS

태그: 디자인 패턴/소프트웨어 원칙
날짜: 2023년 9월 21일

> **하나의 메서드가 Command이면서 동시에 Query일 수는 없다.**
> 

CQS(Command Query Separation)는 말 그대로 Command와 Query를 분리하자는 소프트웨어 원칙이다

만약 Query에서 객체의 상태가 동반되어 바뀐다면 여러번의 쿼리에 따라 결과값이 바뀔 것이다. 그래서 이러한 불안감을 없애기 위해 커맨드와 쿼리를 나눈다. 

- → **참조 투명성**
    
    함수가 언제 어디서 실행 되는지에 상관없이 같은 항상 동일한 입력값에 대해 동일한 결과값을 갖는 것이다. (매서드가 외부 상태를 변경하지 않고)
    

### 그럼 쿼리와 커맨드란 무엇일까?

command(명령)

: 값을 반환시키지 않고, 시스템의 상태를 변화시키는 메서드이다. 

ex) set메서드

query(조회)

: 결과 값을 반환하고, 시스템의 관찰 가능한 상태를 변화시키지 않는 매서드이다.

ex) get메서드

커맨드와 쿼리를 분리하자! → 대규모 시스템 시 유리한 설계 원칙

### 개발 상의 CQS

GET → 조회 → query

POST → 생성 → command

PUT/PATCH → 수정 → command

DELETE → 삭제 → command

만약 데이터의 값을 추가하고, 반환하는 메서드가 있다면 조회의 경우 내부의 값 변경이 없는 매서드로 개발하는 것이 더 좋은 것 같다.

장점

: 읽기 로직과 쓰기 로직을 분리하므로써 각 코드의 역할이 분명하게 나뉘게 함으로써 코드의 가독성을 높여준다.

또한 가독성이 높아지므로 유지보수성을 높이고, 성능 최적화에 도움이 된다.

단점

: 하나의 메소드에 읽기, 쓰기를 동시에 구현해야 할 경우, 간단한 코드를 복잡하게 구현해야 할 수도 있다.

### CQS의 대표적 예외 상황

스택의 pop

: 스택의 pop을 실행하게 된다면 스택의 가장 최근에 저장 된 값을 반환하고, 그 값을 스택에서 삭제하게 된다.

이렇게 된다면 스택의 pop은 데이터를 반환하는 동시에 수정하는 역할 또한 하고있다. 

이러한 유용한 상황에서는 얼마든지 CQS원칙을 깨트려 사용해도 상관 없다.